<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.muesli.mapper.BoardMapper">

<!--    게시판 리스트-->
    <select id="getBoardList" resultType="board">
        SELECT * FROM board ORDER BY brd_order
    </select>

<!--    게시판 정보 호출 -->
    <select id="getBoard" resultType="board">
        SELECT * FROM board WHERE brd_id = #{brd_id}
    </select>

<!--    게시판 그룹별 가장 높은 순서 호출-->
    <select id="getMaxOrder" resultType="int">
        SELECT MAX(brd_order) FROM board WHERE bgr_id = #{bgr_id}
    </select>

<!--    게시판 이름 가져오기-->
    <select id="getBoardName" resultType="board">
        SELECT brd_id, brd_key, brd_name FROM board WHERE brd_key = #{brd_key}
    </select>

<!--    게시물 리스트 갯수 가져오기-->
    <select id="getPostCount" resultType="int">
        SELECT COUNT(post_id) FROM post
        <trim prefix="WHERE" prefixOverrides="AND|OR">
            <if test="search_type != null">
                <choose>
                    <when test="search_type eq 'title'">
                        AND post_title = #{search_type}
                    </when>
                    <when test="search_type eq 'content'">
                        AND post_content = #{search_type}
                    </when>
                    <when test="search_type eq 'nickname'">
                        AND post_nickname = #{search_type}
                    </when>
                </choose>
            </if>
        <if test="isOnlyDel != null">
            AND post_del = #{isOnlyDel}
        </if>
        <if test="brd_id != null">
            AND brd_id = #{brd_id}
        </if>
        </trim>
    </select>
<!--    게시물 리스트 가져오기-->
    <select id="getPostList" resultType="post">
        SELECT * FROM post
        <trim prefix="WHERE" prefixOverrides="AND|OR">
            <if test="search_type != null">
                <choose>
                    <when test="search_type eq 'title'">
                        AND post_title = #{search_type}
                    </when>
                    <when test="search_type eq 'content'">
                        AND post_content = #{search_type}
                    </when>
                    <when test="search_type eq 'nickname'">
                        AND post_nickname = #{search_type}
                    </when>
                </choose>
            </if>
        <if test="isOnlyDel != null">
            AND post_del = #{isOnlyDel}
        </if>
        <if test="brd_id != null">
            AND brd_id = #{brd_id}
        </if>
        </trim>
        <trim prefix="ORDER BY">
            <if test="order_type != null">
                <choose>
                    <when test="order_type eq 'new'">
                        post_datetime DESC
                    </when>
                    <when test="order_type eq 'old'">
                        post_datetime DESC
                    </when>
                    <when test="order_type eq 'like'">
                        post_like DESC
                    </when>
                    <when test="order_type eq 'hit'">
                        post_hit DESC
                    </when>
                    <when test="order_type eq 'comment'">
                        post_comment_count DESC
                    </when>
                </choose>
            </if>
        </trim>
        LIMIT #{pageBean.startRow},#{pageBean.pageSize};
    </select>
<!--    게시판 생성-->
    <insert id="insertBoard">
        INSERT INTO board VALUES (null, #{bgr_id}, #{brd_key}, #{brd_name}, #{brd_mobile_name}, #{brd_order}, #{brd_search})
    </insert>

<!--    게시판 수정-->
    <update id="updateBoard">
        UPDATE board SET brd_name = #{brd_name}, brd_mobile_name = #{brd_mobile_name} WHERE brd_id = #{brd_id}
    </update>

    <!--    대상 게시판 순서 변경-->
    <update id="updateOtherOrder">
        UPDATE board SET brd_order = #{boardBean.brd_order}
        WHERE brd_order =
        <choose>
            <when test="isUp">#{boardBean.brd_order}-1</when>
            <otherwise>#{boardBean.brd_order}+1</otherwise>
        </choose>
            AND bgr_id = #{boardBean.bgr_id}
    </update>

    <!--    해당 메뉴 순서 변경-->
    <update id="updateOrder">
        UPDATE board SET brd_order = #{boardBean.brd_order}
        <choose>
            <when test="isUp">-1</when>
            <otherwise>+1</otherwise>
        </choose>
        WHERE brd_id = #{boardBean.brd_id}
    </update>

    <!--    메뉴 삭제시 뒷 순서 한 칸씩 앞당기기-->
    <update id="pushBoardOrder">
        UPDATE board SET brd_order = brd_order-1
        WHERE brd_order > #{brd_order}
        AND bgr_id = #{bgr_id}
    </update>

<!--    게시판 삭제-->
    <delete id="deleteBoard">
        DELETE FROM board WHERE brd_id = #{brd_id}
    </delete>
</mapper>
